From 469fe13030eb1188dcc1509ee0c13708bb4536d4 Mon Sep 17 00:00:00 2001
From: Dominggoes Isakh <drjisakh@gmail.com>
Date: Sat, 5 Nov 2022 20:51:20 +0100
Subject: [PATCH 3/6] config: Add direct connect rule support for Netd

Change-Id: Ic09389f4356c819716ae21b899de24b2d1f5c4ec
Signed-off-by: Dominggoes Isakh <drjisakh@gmail.com>
---
 build/soong/Android.bp     | 18 ++++++++++++++++++
 config/BoardConfigSoong.mk |  4 ++++
 2 files changed, 22 insertions(+)

diff --git a/build/soong/Android.bp b/build/soong/Android.bp
index 07d4cc3e..7d98a841 100644
--- a/build/soong/Android.bp
+++ b/build/soong/Android.bp
@@ -377,3 +377,21 @@ surfaceflinger_qcom_extensions {
         },
     },
 }
+
+// Netd direct connect rule
+soong_config_module_type {
+    name: "needs_netd_direct_connect_rule",
+    module_type: "cc_defaults",
+    config_namespace: "lineageGlobalVars",
+    bool_variables: ["needs_netd_direct_connect_rule"],
+    properties: ["cppflags"],
+}
+
+needs_netd_direct_connect_rule {
+    name: "needs_netd_direct_connect_rule_defaults",
+    soong_config_variables: {
+        needs_netd_direct_connect_rule: {
+            cppflags: ["-DNEEDS_NETD_DIRECT_CONNECT_RULE"],
+        },
+    },
+}
diff --git a/config/BoardConfigSoong.mk b/config/BoardConfigSoong.mk
index 7cb0150a..de4df162 100644
--- a/config/BoardConfigSoong.mk
+++ b/config/BoardConfigSoong.mk
@@ -112,3 +112,7 @@ SOONG_CONFIG_lineageQcomVars_qcom_display_headers_namespace := vendor/qcom/opens
 else
 SOONG_CONFIG_lineageQcomVars_qcom_display_headers_namespace := $(QCOM_SOONG_NAMESPACE)/display
 endif
+
+# Soong legacy value variables
+SOONG_CONFIG_lineageGlobalVars += needs_netd_direct_connect_rule
+SOONG_CONFIG_lineageGlobalVars_needs_netd_direct_connect_rule := $(TARGET_NEEDS_NETD_DIRECT_CONNECT_RULE)
-- 
2.37.2

