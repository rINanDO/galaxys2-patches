From 7ee6a04e2aaca404af02fdb6897c05d6556b2be1 Mon Sep 17 00:00:00 2001
From: Dominggoes Isakh <drjisakh@gmail.com>
Date: Fri, 28 Oct 2022 18:57:10 +0200
Subject: [PATCH] Revert "Set Bluetooth apex updatable to true"

This reverts commit f261e756b4f10059b6b90847cd208c95adbd8146.
---
 system/Android.bp                      | 1 +
 system/audio_a2dp_hw/Android.bp        | 1 +
 system/audio_hearing_aid_hw/Android.bp | 1 +
 system/btcore/Android.bp               | 3 ---
 system/btif/Android.bp                 | 1 +
 system/embdrv/lc3/Android.bp           | 1 +
 system/gd/Android.bp                   | 1 +
 system/gd/dumpsys/Android.bp           | 1 +
 system/gd/proto/Android.bp             | 3 +++
 system/gd/rust/common/Android.bp       | 1 +
 system/gd/rust/facade/Android.bp       | 1 +
 system/gd/rust/gddi/Android.bp         | 1 +
 system/gd/rust/shim/Android.bp         | 5 +++++
 system/gd/rust/stack/Android.bp        | 2 ++
 system/main/Android.bp                 | 3 ---
 system/osi/Android.bp                  | 5 +----
 system/packet/Android.bp               | 1 +
 system/packet/avrcp/Android.bp         | 1 +
 system/packet/base/Android.bp          | 1 +
 system/profile/avrcp/Android.bp        | 1 +
 20 files changed, 25 insertions(+), 10 deletions(-)

diff --git a/system/Android.bp b/system/Android.bp
index dbb3ebc..f3bbab6 100644
--- a/system/Android.bp
+++ b/system/Android.bp
@@ -155,6 +155,7 @@ rust_protobuf {
     source_stem: "facade",
     host_supported: true,
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/audio_a2dp_hw/Android.bp b/system/audio_a2dp_hw/Android.bp
index 7d77480..56515e7 100644
--- a/system/audio_a2dp_hw/Android.bp
+++ b/system/audio_a2dp_hw/Android.bp
@@ -29,6 +29,7 @@ cc_library {
         "src/audio_a2dp_hw_utils.cc",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     shared_libs: [
diff --git a/system/audio_hearing_aid_hw/Android.bp b/system/audio_hearing_aid_hw/Android.bp
index cb5f110..54b8987 100644
--- a/system/audio_hearing_aid_hw/Android.bp
+++ b/system/audio_hearing_aid_hw/Android.bp
@@ -28,6 +28,7 @@ cc_library {
         "src/audio_hearing_aid_hw_utils.cc",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     shared_libs: [
diff --git a/system/btcore/Android.bp b/system/btcore/Android.bp
index 82ca35b..8e2ad03 100644
--- a/system/btcore/Android.bp
+++ b/system/btcore/Android.bp
@@ -25,9 +25,6 @@ cc_defaults {
     ],
     header_libs: ["libbluetooth_headers"],
     host_supported: true,
-    apex_available: [
-        "com.android.bluetooth",
-    ],
     target: {
         host_linux: {
             cflags: ["-D_GNU_SOURCE"],
diff --git a/system/btif/Android.bp b/system/btif/Android.bp
index 079d12c..15320b1 100644
--- a/system/btif/Android.bp
+++ b/system/btif/Android.bp
@@ -47,6 +47,7 @@ cc_library {
         "libcutils",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/embdrv/lc3/Android.bp b/system/embdrv/lc3/Android.bp
index 68c9724..353f765 100644
--- a/system/embdrv/lc3/Android.bp
+++ b/system/embdrv/lc3/Android.bp
@@ -12,6 +12,7 @@ cc_library_static {
     host_supported: true,
     apex_available: [
 
+        "//apex_available:platform",
         "com.android.bluetooth"
     ],
     defaults: ["fluoride_defaults"],
diff --git a/system/gd/Android.bp b/system/gd/Android.bp
index de8a8a7..8eca557 100644
--- a/system/gd/Android.bp
+++ b/system/gd/Android.bp
@@ -609,6 +609,7 @@ rust_library {
         "liblog_rust",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/gd/dumpsys/Android.bp b/system/gd/dumpsys/Android.bp
index 0241b00..5606d56 100644
--- a/system/gd/dumpsys/Android.bp
+++ b/system/gd/dumpsys/Android.bp
@@ -143,6 +143,7 @@ cc_library {
         "BluetoothGeneratedDumpsysBundledSchema_cc",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/gd/proto/Android.bp b/system/gd/proto/Android.bp
index 1e256e6..6bb3f26 100644
--- a/system/gd/proto/Android.bp
+++ b/system/gd/proto/Android.bp
@@ -18,6 +18,7 @@ java_library_static {
         "bluetooth/bluetoothKeystore/keystore.proto",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
@@ -36,6 +37,7 @@ cc_library_static {
         "bluetooth/bluetoothKeystore/keystore.proto",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
@@ -54,6 +56,7 @@ cc_library_static {
         "bluetooth/bluetoothKeystore/keystore.proto",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/gd/rust/common/Android.bp b/system/gd/rust/common/Android.bp
index 31b6ea8..26a0068 100644
--- a/system/gd/rust/common/Android.bp
+++ b/system/gd/rust/common/Android.bp
@@ -41,6 +41,7 @@ rust_library {
         "libpaste",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/gd/rust/facade/Android.bp b/system/gd/rust/facade/Android.bp
index 82b7956..3d4d0b9 100644
--- a/system/gd/rust/facade/Android.bp
+++ b/system/gd/rust/facade/Android.bp
@@ -59,6 +59,7 @@ rust_library {
         "libcxx",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/gd/rust/gddi/Android.bp b/system/gd/rust/gddi/Android.bp
index b6cff42..91713ac 100644
--- a/system/gd/rust/gddi/Android.bp
+++ b/system/gd/rust/gddi/Android.bp
@@ -16,6 +16,7 @@ rust_library {
     proc_macros: ["libgddi_macros"],
     rustlibs: ["libtokio"],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/gd/rust/shim/Android.bp b/system/gd/rust/shim/Android.bp
index 7521f45..91e91e1 100644
--- a/system/gd/rust/shim/Android.bp
+++ b/system/gd/rust/shim/Android.bp
@@ -60,6 +60,7 @@ rust_ffi_static {
     name: "libbt_shim_ffi",
     defaults: ["libbt_shim_defaults"],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
@@ -98,6 +99,7 @@ cc_library_static {
     ],
     host_supported: true,
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
@@ -115,6 +117,7 @@ cc_library_static {
     ],
     host_supported: true,
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
@@ -131,6 +134,7 @@ cc_library_static {
     generated_headers: ["libbt_shim_bridge_header", "cxx-bridge-header"],
     host_supported: true,
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
@@ -141,6 +145,7 @@ cc_library_headers {
     local_include_dirs: ["callbacks"],
     host_supported: true,
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/gd/rust/stack/Android.bp b/system/gd/rust/stack/Android.bp
index 37d7136..fe6c527 100644
--- a/system/gd/rust/stack/Android.bp
+++ b/system/gd/rust/stack/Android.bp
@@ -36,6 +36,7 @@ rust_library {
         "libnum_derive",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
@@ -116,6 +117,7 @@ cc_library_static {
         "libutils",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/main/Android.bp b/system/main/Android.bp
index 8f8a245..8e2929b 100644
--- a/system/main/Android.bp
+++ b/system/main/Android.bp
@@ -103,9 +103,6 @@ cc_library {
     sanitize: {
         scs: true,
     },
-    apex_available: [
-        "com.android.bluetooth",
-    ],
     host_supported: true,
     min_sdk_version: "30",
 }
diff --git a/system/osi/Android.bp b/system/osi/Android.bp
index bcbac81..f8dbbb6 100644
--- a/system/osi/Android.bp
+++ b/system/osi/Android.bp
@@ -99,10 +99,7 @@ cc_library_static {
             ],
         },
     },
-    min_sdk_version: "Tiramisu",
-    apex_available: [
-        "com.android.bluetooth",
-    ],
+    min_sdk_version: "Tiramisu"
 }
 
 // libosi unit tests for target and host
diff --git a/system/packet/Android.bp b/system/packet/Android.bp
index 1033fc6..1a7d3be 100644
--- a/system/packet/Android.bp
+++ b/system/packet/Android.bp
@@ -20,6 +20,7 @@ cc_library_static {
         "lib-bt-packets-avrcp",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/packet/avrcp/Android.bp b/system/packet/avrcp/Android.bp
index 2b52a75..b5aedd5 100644
--- a/system/packet/avrcp/Android.bp
+++ b/system/packet/avrcp/Android.bp
@@ -42,6 +42,7 @@ cc_library_static {
         "lib-bt-packets-base",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/packet/base/Android.bp b/system/packet/base/Android.bp
index 268f47b..f3a99f9 100644
--- a/system/packet/base/Android.bp
+++ b/system/packet/base/Android.bp
@@ -19,6 +19,7 @@ cc_library_static {
         "packet_builder.cc",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "30",
diff --git a/system/profile/avrcp/Android.bp b/system/profile/avrcp/Android.bp
index 72e9b1b..fb20f65 100644
--- a/system/profile/avrcp/Android.bp
+++ b/system/profile/avrcp/Android.bp
@@ -36,6 +36,7 @@ cc_library_static {
         "liblog",
     ],
     apex_available: [
+        "//apex_available:platform",
         "com.android.bluetooth",
     ],
     min_sdk_version: "Tiramisu"
-- 
2.7.4

